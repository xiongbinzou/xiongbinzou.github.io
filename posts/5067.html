<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Lua语言学习笔记 | 小邹同学</title><meta name="keywords" content="学习笔记,Unity开发基础,Lua基础"><meta name="author" content="小邹同学"><meta name="copyright" content="小邹同学"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Lua是由标准C编写而成的脚本语言，具有高效性、可移植性、可嵌入性、简单强大、小巧轻便、免费开源等诸多优点。"><meta property="og:type" content="article"><meta property="og:title" content="Lua语言学习笔记"><meta property="og:url" content="https://xiongbinzou.github.io/posts/5067.html"><meta property="og:site_name" content="小邹同学"><meta property="og:description" content="Lua是由标准C编写而成的脚本语言，具有高效性、可移植性、可嵌入性、简单强大、小巧轻便、免费开源等诸多优点。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiongbinzou.github.io/pics/avatar.jpg"><meta property="article:published_time" content="2022-08-04T13:00:00.000Z"><meta property="article:modified_time" content="2022-08-22T10:15:31.655Z"><meta property="article:author" content="小邹同学"><meta property="article:tag" content="学习笔记"><meta property="article:tag" content="Unity开发基础"><meta property="article:tag" content="Lua基础"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiongbinzou.github.io/pics/avatar.jpg"><link rel="shortcut icon" href="/pics/favicon.png"><link rel="canonical" href="https://xiongbinzou.github.io/posts/5067"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:300,languages:{author:"作者: 小邹同学",link:"链接: ",source:"来源: 小邹同学",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"top-right"},source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Lua语言学习笔记",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-08-22 18:15:31"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,c={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(c))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!o&&!a&&!c;if(void 0===t){if(a)activateLightMode();else if(o)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((function(e){void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const i=saveToLocal.get("aside-status");void 0!==i&&("hide"===i?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 5.4.2"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/pics/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-graduation-cap"></i> <span>博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i> <span>标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i> <span>相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>影视</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fa fa-gamepad"></i> <span>游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小邹同学</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-graduation-cap"></i> <span>博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-folder-open"></i> <span>分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i> <span>标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i> <span>生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i> <span>相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>影视</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fa fa-gamepad"></i> <span>游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Lua语言学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-04T13:00:00.000Z" title="发表于 2022-08-04 21:00:00">2022-08-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-22T10:15:31.655Z" title="更新于 2022-08-22 18:15:31">2022-08-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Lua/">Lua</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>44分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="0-环境准备">0. 环境准备</h2><h3 id="0-1-简介">0.1 简介</h3><p><strong>Lua</strong>是由标准C编写而成的脚本语言，诞生于1993年，具有<strong>高效性</strong>、<strong>可移植性</strong>、<strong>可嵌入性</strong>、<strong>简单强大</strong>、<strong>小巧轻便</strong>、<strong>免费开源</strong>等诸多优点，主要应用场景包括做为嵌入脚本、做为独立脚本、用于应用程序的动态配置、游戏开发以及Web应用脚本等。</p><h3 id="0-2-Windows下载与安装Lua">0.2 Windows下载与安装Lua</h3><ol><li>选择合适版本的Lua语言开发包<a target="_blank" rel="noopener" href="http://joedf.ahkscript.org/LuaBuilds/">下载</a></li><li>解压下载好的Lua压缩包到合适的路径</li><li>将Lua的解压路径添加到环境变量<code>Path</code>中</li><li>打开Windows命令行工具，输入指令<code>lua</code>，命令行输出Lua版本信息，安装成功</li></ol><h3 id="0-3-CentOS下载与安装Lua">0.3 CentOS下载与安装Lua</h3><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line">curl -R -O http://www.lua.org/ftp/lua-5.4.4.tar.gz  <span class="comment"># 拉取合适的Lua包</span></span><br><span class="line">tar -C /usr/<span class="built_in">local</span> -zxvf lua-5.4.4.tar.gz  <span class="comment"># 解压到合适的目录下</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/lua-5.4.4/  <span class="comment"># 进入Lua包解压路径</span></span><br><span class="line">make all <span class="built_in">test</span>  <span class="comment"># 开始安装</span></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/lua-5.4.4/src/lua /usr/bin/lua  <span class="comment"># 建立连接（可选步骤）</span></span><br><span class="line">lua -v  <span class="comment"># 查看版本，输出Lua版本信息</span></span><br></pre></td></tr></tbody></table></figure><h3 id="0-4-推荐IDE">0.4 推荐IDE</h3><ol><li>VSCode(微软出品) + Lua扩展插件(Tencent出品)</li><li>在线IDE <a target="_blank" rel="noopener" href="https://replit.com/languages/lua">https://replit.com/languages/lua</a></li></ol><h2 id="1-基本数据类型">1. 基本数据类型</h2><h3 id="1-1-table">1.1 table</h3><p><strong>table类型</strong>是一个"关联数组"，需要注意：</p><ol><li>table的索引可以是数字或者是字符串，所有索引值都需要用<code>[</code>和<code>]</code>括起来，如果是字符串，还可以去掉引号和中括号</li><li>table的默认初始索引一般以1开始，如果不写索引，则索引会被认为是数字，并按顺序自动从1往后排</li><li>table变量只是一个地址引用，对table操作不会产生数据影响</li><li>table不固定长度大小，有新数据插入时长度会自动增长</li><li>table里保存数据可以是任何类型，包括<code>function</code>和<code>table</code></li><li>table所有元素之间用逗号<code>,</code>隔开</li></ol><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 初始化</span></span><br><span class="line">mytable = {}</span><br><span class="line"><span class="comment">-- 指定值</span></span><br><span class="line">mytable[<span class="number">1</span>] = <span class="string">"lua"</span></span><br><span class="line">mytable[<span class="string">"name"</span>] = <span class="string">"table"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改值</span></span><br><span class="line">mytable[<span class="number">1</span>] = <span class="string">"Lua"</span></span><br><span class="line"><span class="comment">-- 获取值</span></span><br><span class="line"><span class="built_in">print</span>(mytable[<span class="number">1</span>]) </span><br><span class="line"><span class="comment">-- 输出：Lua</span></span><br><span class="line"><span class="built_in">print</span>(mytable.name) </span><br><span class="line"><span class="comment">-- 输出：table</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除引用</span></span><br><span class="line">mytable = <span class="literal">nil</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-2-string">1.2 string</h3><p><strong>string类型</strong>可以使用双引号<code>""</code>或单引号<code>''</code>声明，如果是块字符串，可以以<code>[[</code>开始，以<code>]]</code>结尾。<br>字符串不可修改值，可以通过<code>string.gsub</code>函数来替换字符串中的子串。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="string">'1024'</span></span><br><span class="line">b = <span class="string">'3.14159'</span></span><br><span class="line">c = <span class="string">"Hello"</span></span><br><span class="line">d = <span class="string">"2022"</span></span><br><span class="line">e = <span class="string">[[</span></span><br><span class="line"><span class="string">	&lt;html&gt;</span></span><br><span class="line"><span class="string">		&lt;head /&gt;</span></span><br><span class="line"><span class="string">		&lt;body&gt;</span></span><br><span class="line"><span class="string">			&lt;a href="https://www.lua.org/"&gt;Lua&lt;/a&gt;</span></span><br><span class="line"><span class="string">		&lt;/body&gt;</span></span><br><span class="line"><span class="string">	&lt;/html&gt;</span></span><br><span class="line"><span class="string">]]</span></span><br><span class="line"><span class="built_in">print</span>(a, b, c, d) </span><br><span class="line"><span class="comment">-- 输出：1024   3.14159 Hello  2022</span></span><br><span class="line"><span class="built_in">print</span>(e) </span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">	&lt;html&gt;</span></span><br><span class="line"><span class="comment">		&lt;head /&gt;</span></span><br><span class="line"><span class="comment">		&lt;body&gt;</span></span><br><span class="line"><span class="comment">			&lt;a href="https://www.lua.org/"&gt;Lua&lt;/a&gt;</span></span><br><span class="line"><span class="comment">		&lt;/body&gt;</span></span><br><span class="line"><span class="comment">	&lt;/html&gt;</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-3-number">1.3 number</h3><p><strong>number类型</strong>只有一种，即<strong>双精度浮点double类型</strong></p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="number">1024</span></span><br><span class="line">b = <span class="number">3.14159</span></span><br><span class="line"><span class="built_in">print</span>(a, <span class="built_in">type</span>(a))</span><br><span class="line"><span class="comment">-- 输出：1024    number</span></span><br><span class="line"><span class="built_in">print</span>(b, <span class="built_in">type</span>(b))</span><br><span class="line"><span class="comment">-- 输出：3.14159 number</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-4-boolean">1.4 boolean</h3><p><strong>boolean类型</strong>只有两个可选值：<strong>true</strong>（真）和 <strong>false</strong>（假）。<strong>判断时false和nil都是假，其他都为真</strong>。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="literal">true</span></span><br><span class="line">b = <span class="literal">false</span></span><br><span class="line"><span class="built_in">print</span>(a, <span class="built_in">type</span>(a))</span><br><span class="line"><span class="comment">-- 输出：true    boolean</span></span><br><span class="line"><span class="built_in">print</span>(b, <span class="built_in">type</span>(b))</span><br><span class="line"><span class="comment">-- 输出：false   boolean</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-5-nil">1.5 nil</h3><p><strong>nil类型</strong>表示一个无效值，只有值<code>nil</code>，如果打印没有赋值的变量，则会输出nil。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"first: "</span>, a)</span><br><span class="line"><span class="comment">-- 输出：first:  nil</span></span><br><span class="line">a = <span class="number">1024</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"second: "</span>, a)</span><br><span class="line"><span class="comment">-- 输出：second:   1024</span></span><br><span class="line">a = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"third: "</span>, a)</span><br><span class="line"><span class="comment">-- 输出：third:  nil</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">type</span>(a) == <span class="string">"nil"</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a is nil"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a is not nil"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 输出：a is nil</span></span><br></pre></td></tr></tbody></table></figure><p><strong>注意</strong>：要判断变量是否为 nil 的时候，需要使用 type 获取变量的类型，然后与字符串的 nil 进行比较</p><h3 id="1-6-function">1.6 function</h3><p><strong>function类型</strong>是由C或Lua编写的完成某一功能的程序指令的集合，称为函数，可分为<strong>自定义函数</strong>和<strong>系统函数</strong>。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">result1 = sum(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">result2 = sum(<span class="number">1024</span>, <span class="number">99</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"result1 = %d, result2 = %d"</span>, result1, result2))</span><br><span class="line"><span class="comment">-- 输出：result1 = 300, result2 = 1123</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-7-thread">1.7 thread</h3><p><strong>thread类型</strong>表示执行的独立线路，用于执行协同程序。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"hello"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">cor = <span class="built_in">coroutine</span>.<span class="built_in">create</span>(fun)</span><br><span class="line"><span class="built_in">print</span>(cor, <span class="built_in">type</span>(cor))</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">thread: 0x13691f0   thread</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-8-userdata">1.8 userdata</h3><p><strong>userdata类型</strong>是一种用户自定义数据，用于表示一种由应用程序或C/C++语言库所创建的类型，可以将任意C/C++的任意数据类型的数据存储在Lua变量中调用。</p><p>userdata可分为<strong>full userdata</strong>和<strong>light userdata</strong>。</p><table><thead><tr><th></th><th>full userdata</th><th>light userdata</th></tr></thead><tbody><tr><td>定义</td><td>用户自定义数据</td><td>一种表示C指针的值，不用创建</td></tr><tr><td>使用</td><td>需要显示的创建一块内存，该段内存有Lua垃圾回收器管理，不需要使用者关心</td><td>存储在栈上，使用者需要关心内存使用</td></tr><tr><td>创建</td><td>没有进行参数合法性检查<br><code>void *lua_newuserdata(lua State *L, size_t size);</code><br>有进行参数合法性检查<br><code>void *lua_checkudata(lua State *L, int arg, const char *tname);</code></td><td><code>void lua_pushlightuserdata(lua_State *L, void *p);</code></td></tr><tr><td>其他</td><td>可以指定其<strong>metatable</strong>和<strong>metamethods</strong></td><td>不可以指定其<strong>metatable</strong>和<strong>metamethods</strong></td></tr></tbody></table><h2 id="2-注释">2. 注释</h2><h3 id="2-1-单行注释">2.1 单行注释</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 这是行注释</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello Lua"</span>)</span><br><span class="line"><span class="comment">-- 这是行注释</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-多行注释">2.2 多行注释</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">这是块注释，</span></span><br><span class="line"><span class="comment">块注释可以</span></span><br><span class="line"><span class="comment">注释多行内容</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Hello Lua"</span>)</span><br></pre></td></tr></tbody></table></figure><h2 id="3-变量">3. 变量</h2><p>变量相当于内存中一个数据存储空间的表示，通过变量名可以访问到变量的具体的值。</p><p>Lua的变量在定义时不需要指定明确的类型，而是会根据赋的默认值来断定变量的类型。</p><h3 id="3-1-变量赋值">3.1 变量赋值</h3><p>赋值是给已经定义的变量重新设置值的过程。</p><p>同时为多个变量赋值时：</p><ul><li><p>当变量个数 &gt; 值的个数时，按变量个数补足nil</p></li><li><p>当变量个数 &lt; 值的个数时，多余的值会被忽略</p></li></ul><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="literal">true</span></span><br><span class="line">c, d = <span class="string">"Hello"</span>, <span class="number">2022</span></span><br><span class="line">name, age, address = <span class="string">"Xiaoming"</span>, <span class="number">18</span></span><br><span class="line">day, week = <span class="number">30</span>, <span class="string">"星期四"</span>, <span class="number">2022</span></span><br><span class="line"><span class="built_in">print</span>(a, b)</span><br><span class="line"><span class="comment">-- 输出：1   true</span></span><br><span class="line"><span class="built_in">print</span>(c, d)</span><br><span class="line"><span class="comment">-- 输出：Hello  2022</span></span><br><span class="line"><span class="built_in">print</span>(name, age, address)</span><br><span class="line"><span class="comment">-- 输出：XiaoMing   18   nil</span></span><br><span class="line"><span class="built_in">print</span>(day, week)</span><br><span class="line"><span class="comment">-- 输出：30  星期四</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-2-全局变量和局部变量">3.2 全局变量和局部变量</h3><p>变量根据作用域可分为全局变量和局部变量，且用<code>local</code>显式声明的变量为局部变量，其余全部为全局变量。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> a = <span class="number">1024</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">pi</span> = <span class="number">3.14159</span></span><br><span class="line">    <span class="keyword">local</span> name = <span class="string">"Lua"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">hello()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"a = "</span>, a, <span class="string">"pi = "</span>, <span class="built_in">pi</span>)</span><br><span class="line"><span class="comment">-- 输出：a =    1024   pi =   3.14159</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"name = "</span>, name)</span><br><span class="line"><span class="comment">-- 输出：name =  nil</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-3-类型转换">3.3 类型转换</h3><p>Lua中，除了table类型，其他任何类型的变量都可以通过<code>tostring</code>函数转化为字符串类型。</p><p>能表示数字的字符串类型的变量可以通过<code>tonumber</code>函数转化为数字类型。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="number">100</span></span><br><span class="line">b = <span class="literal">true</span></span><br><span class="line">sa = <span class="built_in">tostring</span>(a)</span><br><span class="line">sb = <span class="built_in">tostring</span>(b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"sa = "</span>, sa, <span class="string">"type(sa) = "</span>, <span class="built_in">type</span>(sa))</span><br><span class="line"><span class="comment">-- 输出：sa =    100 type(sa) =  string</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"sb = "</span>, sb, <span class="string">"type(sb) = "</span>, <span class="built_in">type</span>(sb))</span><br><span class="line"><span class="comment">-- 输出：sb =    true    type(sb) =  string</span></span><br><span class="line">sc = <span class="string">"3.14"</span></span><br><span class="line">sd = <span class="string">"0XA"</span></span><br><span class="line">c = <span class="built_in">tonumber</span>(sc)</span><br><span class="line">d = <span class="built_in">tonumber</span>(sd)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"c = "</span>, c, <span class="string">"type(c) = "</span>, <span class="built_in">type</span>(c))</span><br><span class="line"><span class="comment">-- 输出：c =    3.14    type(c) =  number</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"d = "</span>, d, <span class="string">"type(d) = "</span>, <span class="built_in">type</span>(d))</span><br><span class="line"><span class="comment">-- 输出：d =    10    type(d) =  number</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-4-获取输入">3.4 获取输入</h3><p>使用<code>io.read</code>函数获取用户输入。</p><p>可选参数：</p><table><thead><tr><th>格式</th><th>描述</th></tr></thead><tbody><tr><td>“*n”</td><td>读取一个数字</td></tr><tr><td>“*a”</td><td>从当前位置读取剩余的全部内容</td></tr><tr><td>"*l”</td><td>读取下一行内容</td></tr><tr><td>10</td><td>读取指定数字的长度</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> name = <span class="built_in">io</span>.<span class="built_in">read</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"name = "</span>, name, <span class="string">"type(name) = "</span>, <span class="built_in">type</span>(name))</span><br><span class="line"><span class="comment">-- 用户输入：Lua</span></span><br><span class="line"><span class="comment">-- 输出：name =   lua type(name) =   string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> num = <span class="built_in">io</span>.<span class="built_in">read</span>(<span class="string">"*n"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"num = "</span>, num, <span class="string">"type(num) = "</span>, <span class="built_in">type</span>(num))</span><br><span class="line"><span class="comment">-- 用户输入：1024</span></span><br><span class="line"><span class="comment">-- 输出：name =   1024 type(name) =   number</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="3-5-格式化输出">3.5 格式化输出</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">name = <span class="string">"lua"</span></span><br><span class="line">age = <span class="number">18</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"name = %s, age = %d"</span>, name, age))</span><br><span class="line"><span class="comment">-- 输出：name = lua, age = 18</span></span><br></pre></td></tr></tbody></table></figure><h2 id="4-循环控制">4. 循环控制</h2><p>循环控制就是让程序满足一定的条件就一直循环的去执行，直到条件不满足，则跳出循环继续执行循环以外的语句。</p><h3 id="4-1-while">4.1 while</h3><p><strong>while循环</strong>，<strong>当型循环</strong>，先判断条件，满足则执行循环，否则不进入循环。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 求和</span></span><br><span class="line"><span class="keyword">local</span> num = <span class="number">0</span></span><br><span class="line"><span class="keyword">local</span> sum = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (num &lt;= <span class="number">100</span>) <span class="keyword">do</span></span><br><span class="line">    sum = sum + num</span><br><span class="line">    num = num + <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"sum = %d"</span>, sum))</span><br><span class="line"><span class="comment">-- 输出：sum = 5050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 打印乘法表</span></span><br><span class="line"><span class="keyword">local</span> i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> (i &lt;= <span class="number">9</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> j = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (j &lt;= i) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%d * %d = % -6d"</span>, j, i, j * i))</span><br><span class="line">        j = j + <span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1 * 1 =  1    </span></span><br><span class="line"><span class="comment">1 * 2 =  2    2 * 2 =  4    </span></span><br><span class="line"><span class="comment">1 * 3 =  3    2 * 3 =  6    3 * 3 =  9    </span></span><br><span class="line"><span class="comment">1 * 4 =  4    2 * 4 =  8    3 * 4 =  12   4 * 4 =  16   </span></span><br><span class="line"><span class="comment">1 * 5 =  5    2 * 5 =  10   3 * 5 =  15   4 * 5 =  20   5 * 5 =  25   </span></span><br><span class="line"><span class="comment">1 * 6 =  6    2 * 6 =  12   3 * 6 =  18   4 * 6 =  24   5 * 6 =  30   6 * 6 =  36   </span></span><br><span class="line"><span class="comment">1 * 7 =  7    2 * 7 =  14   3 * 7 =  21   4 * 7 =  28   5 * 7 =  35   6 * 7 =  42   7 * 7 =  49   </span></span><br><span class="line"><span class="comment">1 * 8 =  8    2 * 8 =  16   3 * 8 =  24   4 * 8 =  32   5 * 8 =  40   6 * 8 =  48   7 * 8 =  56   8 * 8 =  64   </span></span><br><span class="line"><span class="comment">1 * 9 =  9    2 * 9 =  18   3 * 9 =  27   4 * 9 =  36   5 * 9 =  45   6 * 9 =  54   7 * 9 =  63   8 * 9 =  72   9 * 9 =  81</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="4-2-repeat-…-until">4.2 repeat … until</h3><p><strong>repeat until循环</strong>，<strong>直到型循环</strong>，后判断条件，满足则跳出循环，不满足则进入循环，<strong>循环至少会执行1次</strong>。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 求和</span></span><br><span class="line"><span class="keyword">local</span> num = <span class="number">1</span></span><br><span class="line"><span class="keyword">local</span> sum = <span class="number">0</span></span><br><span class="line"><span class="keyword">repeat</span></span><br><span class="line">    sum = sum + num</span><br><span class="line">    num = num + <span class="number">1</span></span><br><span class="line"><span class="keyword">until</span> (num &gt; <span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"sum = %d"</span>, sum))</span><br><span class="line"><span class="comment">-- 输出：sum = 5050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 打印乘法表</span></span><br><span class="line"><span class="keyword">local</span> i = <span class="number">1</span></span><br><span class="line"><span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">local</span> j = <span class="number">1</span></span><br><span class="line">    <span class="keyword">repeat</span></span><br><span class="line">        <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%d * %d = %-6d"</span>, j, i, j * i))</span><br><span class="line">        j = j + <span class="number">1</span></span><br><span class="line">    <span class="keyword">until</span> j &gt; i</span><br><span class="line">  	i = i + <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">until</span> (i &gt; <span class="number">9</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1 * 1 =  1    </span></span><br><span class="line"><span class="comment">1 * 2 =  2    2 * 2 =  4    </span></span><br><span class="line"><span class="comment">1 * 3 =  3    2 * 3 =  6    3 * 3 =  9    </span></span><br><span class="line"><span class="comment">1 * 4 =  4    2 * 4 =  8    3 * 4 =  12   4 * 4 =  16   </span></span><br><span class="line"><span class="comment">1 * 5 =  5    2 * 5 =  10   3 * 5 =  15   4 * 5 =  20   5 * 5 =  25   </span></span><br><span class="line"><span class="comment">1 * 6 =  6    2 * 6 =  12   3 * 6 =  18   4 * 6 =  24   5 * 6 =  30   6 * 6 =  36   </span></span><br><span class="line"><span class="comment">1 * 7 =  7    2 * 7 =  14   3 * 7 =  21   4 * 7 =  28   5 * 7 =  35   6 * 7 =  42   7 * 7 =  49   </span></span><br><span class="line"><span class="comment">1 * 8 =  8    2 * 8 =  16   3 * 8 =  24   4 * 8 =  32   5 * 8 =  40   6 * 8 =  48   7 * 8 =  56   8 * 8 =  64   </span></span><br><span class="line"><span class="comment">1 * 9 =  9    2 * 9 =  18   3 * 9 =  27   4 * 9 =  36   5 * 9 =  45   6 * 9 =  54   7 * 9 =  63   8 * 9 =  72   9 * 9 =  81</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-3-for">4.3 for</h3><p>如果循环的语句是<code>for i = 1, 9, 1 do ...</code>，表示从1开始，大于9结束，每次步进1。如果是步进1，最后1可以省略，变为<code>for i = 1, 9 do ...</code>。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 求和</span></span><br><span class="line"><span class="keyword">local</span> sum = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> num = <span class="number">0</span>, <span class="number">100</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">	sum = sum + num</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"sum = %d"</span>, sum))</span><br><span class="line"><span class="comment">-- 输出：sum = 5050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 打印乘法表</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">9</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j = <span class="number">1</span>, i <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%d * %d = %-6d"</span>, j, i, j * i))</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1 * 1 =  1    </span></span><br><span class="line"><span class="comment">1 * 2 =  2    2 * 2 =  4    </span></span><br><span class="line"><span class="comment">1 * 3 =  3    2 * 3 =  6    3 * 3 =  9    </span></span><br><span class="line"><span class="comment">1 * 4 =  4    2 * 4 =  8    3 * 4 =  12   4 * 4 =  16   </span></span><br><span class="line"><span class="comment">1 * 5 =  5    2 * 5 =  10   3 * 5 =  15   4 * 5 =  20   5 * 5 =  25   </span></span><br><span class="line"><span class="comment">1 * 6 =  6    2 * 6 =  12   3 * 6 =  18   4 * 6 =  24   5 * 6 =  30   6 * 6 =  36   </span></span><br><span class="line"><span class="comment">1 * 7 =  7    2 * 7 =  14   3 * 7 =  21   4 * 7 =  28   5 * 7 =  35   6 * 7 =  42   7 * 7 =  49   </span></span><br><span class="line"><span class="comment">1 * 8 =  8    2 * 8 =  16   3 * 8 =  24   4 * 8 =  32   5 * 8 =  40   6 * 8 =  48   7 * 8 =  56   8 * 8 =  64   </span></span><br><span class="line"><span class="comment">1 * 9 =  9    2 * 9 =  18   3 * 9 =  27   4 * 9 =  36   5 * 9 =  45   6 * 9 =  54   7 * 9 =  63   8 * 9 =  72   9 * 9 =  81</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 遍历table</span></span><br><span class="line">weekdays = {<span class="string">"Sunday"</span>,<span class="string">"Monday"</span>,<span class="string">"Tuesday"</span>,<span class="string">"Wednesday"</span>,<span class="string">"Thursday"</span>,<span class="string">"Friday"</span>,<span class="string">"Saturday"</span>}</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(weekdays) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%s --&gt; %s"</span>, i, v))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1 --&gt; Sunday</span></span><br><span class="line"><span class="comment">2 --&gt; Monday</span></span><br><span class="line"><span class="comment">3 --&gt; Tuesday</span></span><br><span class="line"><span class="comment">4 --&gt; Wednesday</span></span><br><span class="line"><span class="comment">5 --&gt; Thursday</span></span><br><span class="line"><span class="comment">6 --&gt; Friday</span></span><br><span class="line"><span class="comment">7 --&gt; Saturday</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-4-break">4.4 break</h3><p>终止循环的继续运行，如果有多层循环，只能终止当层循环，无法终止外层循环。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i = <span class="number">0</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> j = <span class="number">0</span>, <span class="number">20</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> (j &gt;= <span class="number">2</span>) <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"i = %d, j = %d"</span>, i, j))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">i = 0, j = 0</span></span><br><span class="line"><span class="comment">i = 0, j = 1</span></span><br><span class="line"><span class="comment">i = 1, j = 0</span></span><br><span class="line"><span class="comment">i = 1, j = 1</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><p><strong>Lua中没有continue语句</strong>，但是可以借助for循环以及repeat until循环实现continue功能。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i = <span class="number">0</span>, <span class="number">4</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">repeat</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"i = %d"</span>, i))</span><br><span class="line">    <span class="keyword">until</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">i = 0</span></span><br><span class="line"><span class="comment">i = 1</span></span><br><span class="line"><span class="comment">i = 3</span></span><br><span class="line"><span class="comment">i = 4</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-5-return">4.5 return</h3><p>使用<strong>return语句</strong>，终止循环、函数的执行。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i = <span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">3</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"i = %d"</span>, i))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">i = 0</span></span><br><span class="line"><span class="comment">i = 1</span></span><br><span class="line"><span class="comment">i = 2</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">(value)</span></span></span><br><span class="line">    <span class="keyword">if</span> (value &lt;= <span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"value &lt;= 0"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"value &gt; 0"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">check(<span class="number">12</span>)</span><br><span class="line">check(<span class="number">-1</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">value &gt; 0</span></span><br><span class="line"><span class="comment">value &lt;= 0</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-6-goto">4.6 goto</h3><p>允许将控制流程无条件地转到被标记的语句处，<strong>仅lua5.2以上版本支持</strong>。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> a = <span class="number">1</span></span><br><span class="line">::label:: </span><br><span class="line"><span class="built_in">print</span>(<span class="string">"-- goto label --"</span>)</span><br><span class="line">a = a+<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> a &lt; <span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">goto</span> label</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">-- goto label --</span></span><br><span class="line"><span class="comment">-- goto label --</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-7-pairs和ipairs">4.7 pairs和ipairs</h3><p><strong>pairs和iparis</strong>都是能遍历集合（表、数组），但是<strong>iparis</strong>仅仅遍历值，按照索引升序遍历，索引中断停止遍历，即不能返回nil，只能返回数字0，如果遇到nil则退出。只能遍历到集合中出现的第一个不是整数的key。<strong>pairs</strong>能遍历集合的所有元素。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">table</span> = {<span class="string">"A"</span>, <span class="string">"B"</span>, [<span class="number">5</span>] = <span class="string">"yes"</span>, [<span class="string">"t"</span>] = <span class="string">"no"</span>}</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">table</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i, <span class="built_in">table</span>[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">table</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i, <span class="built_in">table</span>[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1   A</span></span><br><span class="line"><span class="comment">2   B</span></span><br><span class="line"><span class="comment">5   yes</span></span><br><span class="line"><span class="comment">t   no</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1   A</span></span><br><span class="line"><span class="comment">2   B</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5-分支控制">5. 分支控制</h2><p>分支控制就是让程序有选择的执行，主要分为：<strong>单分支</strong>、<strong>双分支</strong>和<strong>多分支</strong>形式。</p><h3 id="5-1-if">5.1 if</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">local</span> b = <span class="number">5</span></span><br><span class="line"><span class="keyword">if</span> (a &gt; b) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a &gt; b"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Out If"</span>)</span><br><span class="line"><span class="comment">--[[ 输出:</span></span><br><span class="line"><span class="comment">a &gt; b</span></span><br><span class="line"><span class="comment">Out If</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="5-2-else">5.2 else</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">local</span> b = <span class="number">5</span></span><br><span class="line"><span class="keyword">if</span> (a &gt; b) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a &gt; b"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a &lt;= b"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Out If"</span>)</span><br><span class="line"><span class="comment">--[[ 输出:</span></span><br><span class="line"><span class="comment">Out If</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="5-3-elseif">5.3 elseif</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> a = <span class="number">5</span></span><br><span class="line"><span class="keyword">local</span> b = <span class="number">5</span></span><br><span class="line"><span class="keyword">if</span> (a &gt; b) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a &gt; b"</span>)</span><br><span class="line"><span class="keyword">elseif</span> (a == b) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a == b"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a &lt;= b"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Out If"</span>)</span><br><span class="line"><span class="comment">--[[ 输出:</span></span><br><span class="line"><span class="comment">a == b</span></span><br><span class="line"><span class="comment">Out If</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="5-4-条件嵌套">5.4 条件嵌套</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> a = <span class="number">5</span></span><br><span class="line"><span class="keyword">local</span> b = <span class="number">5</span></span><br><span class="line"><span class="keyword">if</span> (a &gt; b) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a &gt; b"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> (a == b) <span class="keyword">then</span></span><br><span class="line">    	<span class="built_in">print</span>(<span class="string">"a == b"</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    	<span class="built_in">print</span>(<span class="string">"a &lt;= b"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Out If"</span>)</span><br><span class="line"><span class="comment">--[[ 输出:</span></span><br><span class="line"><span class="comment">a == b</span></span><br><span class="line"><span class="comment">Out If</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="6-函数">6. 函数</h2><p>在程序中，编写函数的<strong>主要目的</strong>是将一个需要很多行代码的复杂问题分解为一系列简单的任务来解决，而且，同一个函数可以被多次调用，有助于代码重用。</p><h3 id="6-1-function">6.1 function</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">result1 = sum(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">result2 = sum(<span class="number">1</span>, <span class="number">99</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"result1 = %d, result2 = %d"</span>, result1, result2));</span><br><span class="line"><span class="comment">--输出：result1 = 300, result2 = 100</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-2-多返回值">6.2 多返回值</h3><p>Lua中的函数可以不返回任何值，也可以返回一个值，也支持返回多个值。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_user</span><span class="params">(score)</span></span></span><br><span class="line">    <span class="keyword">if</span> score &gt; <span class="number">85</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"A"</span>, <span class="literal">true</span></span><br><span class="line">    <span class="keyword">elseif</span> score &gt; <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"B"</span>, <span class="literal">true</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"C"</span>, <span class="literal">false</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> level1, isOk = check_user(<span class="number">99</span>)</span><br><span class="line"><span class="keyword">local</span> level2, _ = check_user(<span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"level1 = %s, level2 = %s"</span>, level1, level2))</span><br><span class="line"><span class="comment">-- 输出：level1 = A, level2 = C</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-3-可变参数">6.3 可变参数</h3><p>函数参数的个数可以是任意的，可变参数使用<code>...</code>来表示，若想要获取用户传入的所有的参数，可以使用<code>arg</code>变量。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">arg</span> = {...}</span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> iparis(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">        result = result + v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">result = sum(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"result = %d"</span>, result))</span><br><span class="line"><span class="comment">-- 输出：result = 25</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-4-匿名函数">6.4 匿名函数</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test_func</span><span class="params">(tab, fun)</span></span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(tab) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(fun(k, v))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">tab = {key1 = <span class="string">"val1"</span>, key2 = <span class="string">"val2"</span>}</span><br><span class="line">test_func(tab, <span class="function"><span class="keyword">function</span><span class="params">(key, val)</span></span> <span class="keyword">return</span> key .. <span class="string">" = "</span> .. val <span class="keyword">end</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">key1 = val1</span></span><br><span class="line"><span class="comment">key2 = val2</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-5-闭包">6.5 闭包</h3><p>闭包的主要作用：</p><ul><li>简洁，不需要在不使用时生成对象，也不需要函数名</li><li>可以捕获外部变量形成不同的调用环境</li></ul><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">        index = index + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> index</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> inner1 = func()</span><br><span class="line"><span class="built_in">print</span>(inner1(), inner1())</span><br><span class="line"><span class="comment">-- 输出：1   2</span></span><br><span class="line"><span class="keyword">local</span> inner2 = func()</span><br><span class="line"><span class="built_in">print</span>(inner2(), inner2())</span><br><span class="line"><span class="comment">-- 输出：1   2</span></span><br></pre></td></tr></tbody></table></figure><h2 id="7-运算符">7. 运算符</h2><h3 id="7-1-算术运算符">7.1 算术运算符</h3><p><strong>算术运算符</strong>是对数值类型的变量进行运算的。</p><table><thead><tr><th>运算符</th><th>说明</th><th>范例</th><th>结果</th></tr></thead><tbody><tr><td>+</td><td>正号</td><td>+3</td><td>3</td></tr><tr><td>-</td><td>负号</td><td>-4</td><td>-3</td></tr><tr><td>+</td><td>加法运算</td><td>5 + 5</td><td>10</td></tr><tr><td>-</td><td>减法运算</td><td>10 - 5</td><td>5</td></tr><tr><td>*</td><td>乘法运算</td><td>5 * 2</td><td>10</td></tr><tr><td>/</td><td>除法运算</td><td>10 / 3</td><td>3.3</td></tr><tr><td>%</td><td>取余运算</td><td>10 % 3</td><td>1</td></tr><tr><td>^</td><td>幂运算</td><td>2^3</td><td>8</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a, b = <span class="number">-20</span>, <span class="number">3</span></span><br><span class="line"><span class="keyword">local</span> c = a + b</span><br><span class="line"><span class="keyword">local</span> d = a - b</span><br><span class="line"><span class="keyword">local</span> e = a * b</span><br><span class="line"><span class="keyword">local</span> f = a / b</span><br><span class="line"><span class="keyword">local</span> g = a % b</span><br><span class="line"><span class="keyword">local</span> h = a ^ b</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"c = %d, d = %d, e = %d, f = %f, g = %d, h = %d"</span>, c, d, e, f, g, h))</span><br><span class="line"><span class="comment">-- 输出：c = -17, d = -23, e = -60, f = -6.666667, g = 1, h = -8000</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-2-关系运算符">7.2 关系运算符</h3><p><strong>关系运算符</strong>结果要么是真，要么是假。</p><table><thead><tr><th>运算符</th><th>说明</th><th>范例</th><th>结果</th></tr></thead><tbody><tr><td>==</td><td>相等</td><td>4 == 3</td><td>false</td></tr><tr><td>~=</td><td>不等于</td><td>4 ~= 3</td><td>true</td></tr><tr><td>&lt;</td><td>小于</td><td>4 &lt; 3</td><td>false</td></tr><tr><td>&gt;</td><td>大于</td><td>4 &gt; 3</td><td>true</td></tr><tr><td>&lt;=</td><td>小于等于</td><td>4 &lt;= 3</td><td>false</td></tr><tr><td>&gt;=</td><td>大于等于</td><td>4 &gt;= 3</td><td>true</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="number">100</span></span><br><span class="line">b = <span class="number">99</span></span><br><span class="line"><span class="keyword">local</span> c = a == b</span><br><span class="line"><span class="keyword">local</span> d = a ~= b</span><br><span class="line"><span class="keyword">local</span> e = a &gt; b</span><br><span class="line"><span class="keyword">local</span> f = a &lt; b</span><br><span class="line"><span class="keyword">local</span> g = a &gt;= b</span><br><span class="line"><span class="keyword">local</span> h = a &lt;= b</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"c = "</span>, c, <span class="string">"d = "</span>, d, <span class="string">"e = "</span>, e, <span class="string">"f = "</span>, f, <span class="string">"g = "</span>, g, <span class="string">"h = "</span>, h)</span><br><span class="line"><span class="comment">-- 输出：c =     false   d =     true    e =     true    f =     false   g =     true    h =     false</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-3-逻辑运算符">7.3 逻辑运算符</h3><p><strong>逻辑运算符</strong>用来连接多个条件，最终返回是true或false，使用逻辑运算符可以模拟三目运算符。</p><table><thead><tr><th>运算符</th><th>说明</th><th>范例</th></tr></thead><tbody><tr><td>and</td><td>逻辑与</td><td>A and B，如果A的值为假，则不会再计算B的值</td></tr><tr><td>or</td><td>逻辑或</td><td>A or B，如果A的值为真，则不会再计算B的值</td></tr><tr><td>not</td><td>逻辑非</td><td>not A</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> age = <span class="number">40</span></span><br><span class="line"><span class="keyword">local</span> b = age &gt; <span class="number">30</span> <span class="keyword">and</span> age &lt; <span class="number">50</span></span><br><span class="line"><span class="keyword">local</span> c = age &gt; <span class="number">40</span> <span class="keyword">or</span> age &lt; <span class="number">30</span></span><br><span class="line"><span class="keyword">local</span> d = <span class="keyword">not</span> age</span><br><span class="line"><span class="keyword">local</span> e = <span class="keyword">not</span> <span class="literal">nil</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="keyword">not</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">local</span> g = age &gt; <span class="number">30</span> <span class="keyword">and</span> age <span class="keyword">or</span> <span class="number">30</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"b = "</span>, b, <span class="string">"c = "</span>, c, <span class="string">"d = "</span>, d, <span class="string">"e = "</span>, e, <span class="string">"f = "</span>, f, <span class="string">"g = "</span>, g)</span><br><span class="line"><span class="comment">-- 输出：b =     true    c =     false   d =     false   e =     true   f =     false   g = 40</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-4-其他运算符">7.4 其他运算符</h3><table><thead><tr><th>运算符</th><th>说明</th><th>范例</th></tr></thead><tbody><tr><td>…</td><td>连接运算符</td><td>str1…str2</td></tr><tr><td>#</td><td>获取字符串长度</td><td>#str1</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> str1 = <span class="string">"hello"</span></span><br><span class="line"><span class="keyword">local</span> str2 = <span class="string">"lua"</span></span><br><span class="line"><span class="keyword">local</span> str3 = str1..str2</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str3 = %s, #str3 = %d"</span>, str3, #str3))</span><br><span class="line"><span class="comment">-- 输出：str3 = hellolua, #str3 = 8</span></span><br></pre></td></tr></tbody></table></figure><h2 id="8-字符串">8. 字符串</h2><h3 id="8-1-字符串函数">8.1 字符串函数</h3><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>upper(arg)</td><td>字符串全部转为大写字母</td></tr><tr><td>lower(arg)</td><td>字符串全部转为小写字母</td></tr><tr><td>sub(s, i, [,j])</td><td>截取字符串</td></tr><tr><td>gsub(mainString, findString, replaceString, num)</td><td>在字符串中替换</td></tr><tr><td>dump(function)</td><td>把函数序列化为字符串来保存</td></tr><tr><td>find(str, substr, [init, [end]])</td><td>在字符串中查找，存在返回具体位置，不存在返回nil</td></tr><tr><td>reverse(arg)</td><td>字符串反转</td></tr><tr><td>format(…)</td><td>返回一个格式化字符串</td></tr><tr><td>char(arg)</td><td>将整型数字转化为字符并连接</td></tr><tr><td>byte[arg[int,]]</td><td>byte转换字符为整数值</td></tr><tr><td>len(arg)</td><td>计算字符串长度</td></tr><tr><td>rep(string, n)</td><td>返回字符串string的n个拷贝</td></tr><tr><td>…</td><td>连接两个字符串</td></tr><tr><td>gmatch(str, pattern)</td><td>迭代器函数，每次调用返回一个查找到的子串</td></tr><tr><td>match(str, pattern, init)</td><td>查找第一个配对的子串</td></tr></tbody></table><h3 id="8-1-大小写转换">8.1 大小写转换</h3><p><code>string.upper(s)</code> 用于将字符串中所有字母转化为大写。</p><p><code>string.lower(s)</code> 用于将字符串中所有字母转化为小写。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str1 = <span class="string">"Hello Lua"</span></span><br><span class="line">str2 = <span class="built_in">string</span>.<span class="built_in">upper</span>(str1)</span><br><span class="line">str3 = <span class="built_in">string</span>.<span class="built_in">lower</span>(str1)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str1 = %s, str2 = %s, str3 = %s"</span>, str1, str2, str3))</span><br><span class="line"><span class="comment">-- 输出：str1 = Hello Lua, str2 = HELLO LUA, str3 = hello lua</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-2-字符串截取">8.2 字符串截取</h3><p><code>string.sub(s, i [, j])</code> 用于字符串截取，返回字符串s从第i个字符到第j个字符的子串。注意，字符串的第1个字符索引是1。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str1 = <span class="string">"Hello Lua"</span></span><br><span class="line">str2 = <span class="built_in">string</span>.<span class="built_in">sub</span>(str1, <span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">str3 = <span class="built_in">string</span>.<span class="built_in">sub</span>(str1, <span class="number">-3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str1 = %s, str2 = %s, str3 = %s"</span>, str1, str2, str3))</span><br><span class="line"><span class="comment">-- 输出：str1 = Hello Lua, str2 = Hello, str3 = Lua</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-3-字符串替换">8.3 字符串替换</h3><p><code>string.gsub(mainString, findString, replaceString, num)</code> 用于字符串替换，num指定替换字符串的次数，默认全部替换。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str1 = <span class="string">"Hello world, Hello Lua"</span></span><br><span class="line">str2 = <span class="built_in">string</span>.<span class="built_in">gsub</span>(str1, <span class="string">"Hello"</span>, <span class="string">"Nihao"</span>)</span><br><span class="line">str3 = <span class="built_in">string</span>.<span class="built_in">gsub</span>(str1, <span class="string">"Hello"</span>, <span class="string">"Nihao"</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str1 = %s, str2 = %s, str3 = %s"</span>, str1, str2, str3))</span><br><span class="line"><span class="comment">-- 输出：str1 = Hello world, Hello Lua, str2 = Nihao world, Nihao Lua, str3 = Nihao world, Hello Lua</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-4-序列化与加载">8.4 序列化与加载</h3><p><code>string.dump(function)</code> 用于将函数序列化为字符串，便于函数的保存与传输<code>loadstring(str)</code> 用于将序列化后的函数字符串反序列化加载为函数。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span><span class="params">(a, b)</span></span></span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">str = <span class="built_in">string</span>.<span class="built_in">dump</span>(sum)</span><br><span class="line">res = <span class="built_in">loadstring</span>(str)</span><br><span class="line"><span class="built_in">print</span>(str, res(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="comment">-- 输出：uaQ 3</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-5-字符串查找">8.5 字符串查找</h3><p><code>string.find(str, substr, [init, [end]])</code> 用于在一个指定的目标字符串中搜素指定的内容，返回其具体位置，不存在返回nil，也支持使用正则匹配查找。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str1 = <span class="string">"Hello Lua"</span></span><br><span class="line">index1 = <span class="built_in">string</span>.<span class="built_in">find</span>(<span class="string">"Hello Lua"</span>, <span class="string">"Lua"</span>)</span><br><span class="line">index2 = <span class="built_in">string</span>.<span class="built_in">find</span>(<span class="string">"Hello Lua"</span>, <span class="string">"Lua"</span>, <span class="number">8</span>)</span><br><span class="line">index3 = <span class="built_in">string</span>.<span class="built_in">find</span>(<span class="string">"Hello Lua"</span>, <span class="string">"%s%u%a."</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"index1 = "</span>, index1, <span class="string">"index2 = "</span>, index2, <span class="string">"index3 = "</span>, index3)</span><br><span class="line"><span class="comment">-- 输出：index1 =   7   index2 =   nil   index3 =   6</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-6-字符串反转">8.6 字符串反转</h3><p><code>string.reverse(arg)</code> 用于反转字符串。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str = <span class="string">"Hello Lua"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str = %s, res = %s"</span>, str, <span class="built_in">string</span>.<span class="built_in">reverse</span>(str)))</span><br><span class="line"><span class="comment">-- 输出：str = Hello Lua, res = auL olleH</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-7-格式化字符串">8.7 格式化字符串</h3><table><thead><tr><th>格式</th><th>描述</th><th>格式</th><th>描述</th></tr></thead><tbody><tr><td>%c</td><td>接收数字，转化为字符</td><td>%d,%i</td><td>接收数字，转化为有符号整数</td></tr><tr><td>%o</td><td>接收数字，转化为八进制数</td><td>%u</td><td>接收数字，转化为无符号整数</td></tr><tr><td>%x</td><td>接收数字，转化为十六进制数，使用小写字母</td><td>%X</td><td>接收数字，转化为十六进制数，使用大写字母</td></tr><tr><td>%e</td><td>接收数字，转化为科学计数法，使用小写字母e</td><td>%E</td><td>接收数字，转化为科学计数法，使用大写字母E</td></tr><tr><td>%f</td><td>接收数字，转化为浮点数</td><td>%g,%G</td><td>接收数字，转化为%e,%f中较短格式</td></tr><tr><td>%q</td><td>接收字符串，转化为可安全被Lua编译器读入的格式</td><td>%s</td><td>接收字符串，按给定参数格式化字符串</td></tr><tr><td>%+</td><td>表示其后的数字转义符将让正数显示正号</td><td>%占位符</td><td>在后面指定了字串宽度时占位用</td></tr><tr><td>%对齐标识</td><td>在指定了字串宽度时, 默认为右对齐, 增加 - 号改为左对齐</td><td>%宽度数值</td><td>占位宽度</td></tr><tr><td>%小数位数/字串裁切</td><td>数字保留位数，字符串做裁切</td><td></td><td></td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%c"</span>, <span class="number">65</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%+d"</span>, <span class="number">17.0</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%05d"</span>, <span class="number">17</span>))</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">A</span></span><br><span class="line"><span class="comment">+17</span></span><br><span class="line"><span class="comment">00017</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-8-数字与字符的转换">8.8 数字与字符的转换</h3><p><code>string.char(arg)</code> 用于将整数转化为字符并连接。</p><p><code>string.byte(arg[,int])</code> 用于将字符转化为整数并连接，int表示要转换的字符。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">char</span>(<span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">"ABCD"</span>, <span class="number">3</span>))</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">abc</span></span><br><span class="line"><span class="comment">67</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-9-字符串长度">8.9 字符串长度</h3><p><code>string.len()</code>用于获取字符串长度，另外<code>#</code>也可以获取字符串长度。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str1 = <span class="string">"ABC"</span></span><br><span class="line">str2 = <span class="string">"Hello"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str1's len = %d, str2's len = %d"</span>, <span class="built_in">string</span>.<span class="built_in">len</span>(str1), #str2))</span><br><span class="line"><span class="comment">-- 输出：str1's len = 3, str2's len = 5</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-10-字符串拷贝">8.10 字符串拷贝</h3><p><code>string.rep(string, n)</code> 用于将字符串拷贝n次。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str = <span class="string">"ABCD"</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str = %s"</span>, <span class="built_in">string</span>.<span class="built_in">rep</span>(str, <span class="number">2</span>)))</span><br><span class="line"><span class="comment">-- 输出：str = ABCDABCD</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-11-字符串连接">8.11 字符串连接</h3><p>字符串可以使用<code>..</code>连接。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">str1 = <span class="string">"hello"</span></span><br><span class="line">str2 = <span class="string">"lua"</span></span><br><span class="line">res = str1 .. <span class="string">" "</span> .. str2</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"res = %s"</span>, res))</span><br><span class="line"><span class="comment">-- 输出：hello lua</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-12-字符串匹配">8.12 字符串匹配</h3><p><code>string.gmatch(str, pattern)</code> 是一个迭代器函数，每调用一次，返回一个在字符串str查找到的符合pattern描述的子串，如果没找到返回nil，也支持正则匹配。</p><p><code>string.match(str, pattern, init)</code> 只找寻str中第一个配对，搜索起点可配置，也支持正则匹配。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(<span class="string">"Hello Lua"</span>, <span class="string">"%a+"</span>) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(word)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">match</span>(<span class="string">"I have 2 questions for you."</span>, <span class="string">"%d+ %a+"</span>))</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">Hello</span></span><br><span class="line"><span class="comment">Lua</span></span><br><span class="line"><span class="comment">2 questions</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8-13-转义字符">8.13 转义字符</h3><table><thead><tr><th>转义字符</th><th>意义</th><th>转义字符</th><th>意义</th></tr></thead><tbody><tr><td>\a</td><td>响铃</td><td>\b</td><td>退格，将当前位置移到前一列</td></tr><tr><td>\f</td><td>换页，将当前位置移到下页开头</td><td>\n</td><td>换行，将当前位置移到下一行开头</td></tr><tr><td>\r</td><td>回车，将当前位置移到本行开头</td><td>\t</td><td>水平制表，跳到下一个Tab位置</td></tr><tr><td>\v</td><td>垂直制表</td><td>\</td><td>代表一个反斜线字符</td></tr><tr><td>’</td><td>代表一个单引号字符</td><td>"</td><td>代表一个双引号字符</td></tr><tr><td>\0</td><td>空字符</td><td>\ddd</td><td>1到3位八进制数所代表的任意字符</td></tr><tr><td>\xhh</td><td>1到2位十六进制数所代表的任意字符</td><td></td><td></td></tr></tbody></table><h2 id="9-Table">9. Table</h2><p><strong>数组与表的类型都为table</strong>。</p><p>数组的语法为<code>arrName = {element1, element2, ....}</code>，数组保存的一组数据类型可以不一致，数组的索引值是以1为起始的，也可以人为指定为0开始，如<code>arrName = {[0]=element1, element2, ....}</code>。</p><p>表是一个 “关联数组”，表的索引可以是数字或者是字符串，所有索引值都需要用 <code>[</code> 和 <code>]</code> 括起来；如果没有 [] 括起，则认为是字符串索引，可以认为，数组是索引为以0或1开始的连续数字的一种特殊的表，因此，表的一些增删改查行为函数也适用于数组。</p><table><thead><tr><th>操作</th><th>描述</th></tr></thead><tbody><tr><td>concat</td><td>连接</td></tr><tr><td>insert</td><td>插入</td></tr><tr><td>maxn</td><td>最大key</td></tr><tr><td>remove</td><td>移除</td></tr><tr><td>sort</td><td>升序排序</td></tr></tbody></table><h3 id="9-1-定义">9.1 定义</h3><p><code>#</code>后面直接加数组名可以获取数组的长度，如果设置了索引从0开始，则获取到的数组长度会比实际的长度少1。</p><p><code>#</code>后面直接加表名无法准确获取数组的长度，会在索引中断的地方停止计数，应该用循环遍历来获取正确长度。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 数组</span></span><br><span class="line">letters = {}</span><br><span class="line">letters[<span class="number">1</span>] = <span class="string">"A"</span></span><br><span class="line">letters[<span class="number">2</span>] = <span class="string">"B"</span></span><br><span class="line">letters[<span class="number">3</span>] = <span class="string">"C"</span></span><br><span class="line">letters[<span class="number">4</span>] = <span class="string">"D"</span></span><br><span class="line">letters[<span class="number">5</span>] = <span class="string">"E"</span></span><br><span class="line">days = {[<span class="number">0</span>]=<span class="string">"Monday"</span>, <span class="string">"Tuesday"</span>, <span class="string">"Wednesday"</span>, <span class="string">"Thursday"</span>, <span class="string">"Friday"</span>, <span class="string">"Saturday"</span>, <span class="string">"Sunday"</span>}</span><br><span class="line">numbers = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="literal">nil</span>}</span><br><span class="line">all = {<span class="number">1</span>, <span class="string">"A"</span>, <span class="literal">nil</span>, <span class="literal">true</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Len: letters = %d, days = %d, numbers = %d, all = %d"</span>, #letters, #days, #numbers, #all))</span><br><span class="line"><span class="comment">-- 输出：Len: letters = 5, days = 6, numbers = 3, all = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表</span></span><br><span class="line">mytable1 = {[<span class="number">1</span>] = <span class="string">"Lua"</span>, greet = <span class="string">"Hello"</span>, [<span class="number">3</span>] = <span class="string">"Count"</span>}</span><br><span class="line">mytable2 = {}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"Len: mytable1 = %d, mytable2 = %d"</span>, #mytable1, #mytable2))</span><br><span class="line"><span class="comment">-- 输出：Len: mytable1 = 1, mytable2 = 0</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-2-遍历">9.2 遍历</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 数组</span></span><br><span class="line">days = {[<span class="number">0</span>]=<span class="string">"Monday"</span>, <span class="string">"Tuesday"</span>, <span class="string">"Wednesday"</span>, <span class="string">"Thursday"</span>, <span class="string">"Friday"</span>, <span class="string">"Saturday"</span>, <span class="string">"Sunday"</span>}</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">0</span>, #days <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"days[%d] = %s"</span>, i, days[i]))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">days[0] = Monday</span></span><br><span class="line"><span class="comment">days[1] = Tuesday</span></span><br><span class="line"><span class="comment">days[2] = Wednesday</span></span><br><span class="line"><span class="comment">days[3] = Thursday</span></span><br><span class="line"><span class="comment">days[4] = Friday</span></span><br><span class="line"><span class="comment">days[5] = Saturday</span></span><br><span class="line"><span class="comment">days[6] = Sunday</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br><span class="line">letters = {<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>}</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span>(letters) <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"letters[%d] = %s"</span>, i, v))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">letters[1] = A</span></span><br><span class="line"><span class="comment">letters[2] = B</span></span><br><span class="line"><span class="comment">letters[3] = C</span></span><br><span class="line"><span class="comment">letters[4] = D</span></span><br><span class="line"><span class="comment">letters[5] = E</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 表</span></span><br><span class="line">mytable = {[<span class="number">1</span>] = <span class="string">"Lua"</span>, greet = <span class="string">"Hello"</span>, [<span class="number">3</span>] = <span class="string">"Count"</span>}</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span>(mytable) <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">print</span>(i, v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1   Lua</span></span><br><span class="line"><span class="comment">3   Count</span></span><br><span class="line"><span class="comment">greet   Hello</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="9-3-连接">9.3 连接</h3><p><code>table.concat(table [, sep [, start [, end]]])</code> 函数列出参数中指定table的数组部分从start位置到end位置的所有元素，元素键以指定分隔符sep隔开，start默认为1。注：该函数只处理table下标为数字的数据，且下标是连续的才能被处理，断开就结束了。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">fruits = {<span class="string">"orange"</span>, <span class="string">"apple"</span>, <span class="string">"banana"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str = %s"</span>, <span class="built_in">table</span>.<span class="built_in">concat</span>(fruits, <span class="string">", "</span>)))</span><br><span class="line"><span class="comment">-- 输出：orange, apple, banana</span></span><br><span class="line"></span><br><span class="line">letters = {[<span class="number">0</span>]=<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str = %s"</span>, <span class="built_in">table</span>.<span class="built_in">concat</span>(letters, <span class="string">", "</span>)))</span><br><span class="line"><span class="comment">-- 输出：B, C, D, E</span></span><br><span class="line"></span><br><span class="line">mytable = {[<span class="number">1</span>] = <span class="string">"Lua"</span>, greet = <span class="string">"Hello"</span>, [<span class="number">3</span>] = <span class="string">"Count"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"str = %s"</span>, <span class="built_in">table</span>.<span class="built_in">concat</span>(mytable, <span class="string">", "</span>)))</span><br><span class="line"><span class="comment">-- 输出：Lua</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-4-插入">9.4 插入</h3><p><code>table.insert(table [pos,] value)</code> 函数在table指定位置pos插入一个value元素，pos默认为数组部分末尾，即连续下标元素的最后。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">fruits = {<span class="string">"orange"</span>, <span class="string">"apple"</span>, <span class="string">"banana"</span>}</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(fruits, <span class="number">3</span>, <span class="string">"watermelon"</span>)</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(fruits) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k, v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1   orange</span></span><br><span class="line"><span class="comment">2   apple</span></span><br><span class="line"><span class="comment">3   watermelon</span></span><br><span class="line"><span class="comment">4   banana</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br><span class="line">letters = {[<span class="number">0</span>]=<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>}</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(letters, <span class="number">3</span>, <span class="string">"W"</span>)</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">0</span>， #letters <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i, letters[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">0   A</span></span><br><span class="line"><span class="comment">1   B</span></span><br><span class="line"><span class="comment">2   C</span></span><br><span class="line"><span class="comment">3   W</span></span><br><span class="line"><span class="comment">4   D</span></span><br><span class="line"><span class="comment">5   E</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"></span><br><span class="line">mytable = {[<span class="number">1</span>] = <span class="string">"Lua"</span>, greet = <span class="string">"Hello"</span>, [<span class="number">3</span>] = <span class="string">"Count"</span>}</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(mytable, <span class="number">2</span>, <span class="string">"Table"</span>)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(mytable) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k,v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(#mytable)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1   Lua</span></span><br><span class="line"><span class="comment">2   Table</span></span><br><span class="line"><span class="comment">3   Count</span></span><br><span class="line"><span class="comment">greet   Hello</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-5-最大值">9.5 最大值</h3><p><code>table.maxn(table)</code> 函数返回table的最大正数索引，如果没有正数索引返回0。Lua5.2之后的版本已移除该函数。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">fruits = {<span class="string">"orange"</span>, <span class="string">"apple"</span>, <span class="string">"banana"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">table</span>.<span class="built_in">maxn</span>(fruits))</span><br><span class="line"></span><br><span class="line">letters = {[<span class="number">0</span>]=<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">table</span>.<span class="built_in">maxn</span>(letters))</span><br><span class="line"></span><br><span class="line">mytable = {[<span class="number">1</span>] = <span class="string">"Lua"</span>, greet = <span class="string">"Hello"</span>, [<span class="number">3</span>] = <span class="string">"Count"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">table</span>.<span class="built_in">maxn</span>(mytable))</span><br><span class="line"></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-6-删除">9.6 删除</h3><p><code>table.remove(table [,pos])</code> 函数删除指定pos位置的元素，pos默认为table长度。即连续索引的最大值。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">fruits = {<span class="string">"orange"</span>, <span class="string">"apple"</span>, <span class="string">"banana"</span>}</span><br><span class="line">remove1 = <span class="built_in">table</span>.<span class="built_in">remove</span>(fruits)</span><br><span class="line">remove2 = <span class="built_in">table</span>.<span class="built_in">remove</span>(fruits, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"remove1 = %s, remove2 = %s"</span>, remove1, remove2))</span><br><span class="line"><span class="comment">-- 输出：remove1 = banana, remove2 = orange</span></span><br><span class="line"></span><br><span class="line">mytable = {[<span class="number">1</span>] = <span class="string">"Lua"</span>, greet = <span class="string">"Hello"</span>, [<span class="number">3</span>] = <span class="string">"Count"</span>}</span><br><span class="line"><span class="built_in">remove</span> = <span class="built_in">table</span>.<span class="built_in">remove</span>(mytable)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"remove = %s"</span>, <span class="built_in">remove</span>))</span><br><span class="line"><span class="comment">-- 输出：remove = Lua</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-7-排序">9.7 排序</h3><p><code>table.sort(table [,comp])</code> 函数用于对给定的table进行升序排序，还支持传入排序规则。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> test0 ={<span class="number">1</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">6</span>}</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(test0)</span><br><span class="line"><span class="keyword">for</span> i,v <span class="keyword">in</span> <span class="built_in">pairs</span>(test0) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">write</span>(v..<span class="string">" "</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">local</span> test1 ={</span><br><span class="line">                {id=<span class="number">1</span>, name=<span class="string">"deng"</span>},</span><br><span class="line">                {id=<span class="number">9</span>, name=<span class="string">"luo"</span>},</span><br><span class="line">                {id=<span class="number">2</span>, name=<span class="string">"yang"</span>},</span><br><span class="line">                {id=<span class="number">8</span>, name=<span class="string">"ma"</span>},</span><br><span class="line">                {id=<span class="number">5</span>, name=<span class="string">"wu"</span>},</span><br><span class="line">}</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(test1, <span class="function"><span class="keyword">function</span><span class="params">(a,b)</span></span> <span class="keyword">return</span> a.id &lt; b.id <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">pairs</span>(test1) <span class="keyword">do</span></span><br><span class="line">   <span class="built_in">print</span>(test1[i].id, test1[i].name)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1 2 3 4 6 7 8 9</span></span><br><span class="line"><span class="comment">1   deng</span></span><br><span class="line"><span class="comment">2   yang</span></span><br><span class="line"><span class="comment">5   wu</span></span><br><span class="line"><span class="comment">8   ma</span></span><br><span class="line"><span class="comment">9   luo</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="10-元素metatable">10. 元素metatable</h2><h3 id="10-1-定义">10.1 定义</h3><p>Lua的table中可以访问对应的key来得到value值，但是却无法对两个table进行操作。元表允许改变table的行为，每个行为关联了对应的元方法。如两个table相加操作<code>a+b</code>，当Lua尝试对两个表相加时，先检查两者之一是否有元表，之后检查<code>__add</code>字段是否存在，如果操作，则调用相应的值。<code>__add</code>等即时字段其对应的值就是元方法。</p><p>有两个重要的函数处理元表：</p><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>setmetatable(table, metatable)</td><td>对指定的table设置元表，如果元表中存在<code>__metatable</code>键值，则setmetatable会失败</td></tr><tr><td>getmetatable(table)</td><td>返回对象的元表</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">mytable = {}      <span class="comment">-- 普通表</span></span><br><span class="line">mymetatable = {}  <span class="comment">-- 元表</span></span><br><span class="line"><span class="built_in">setmetatable</span>(mytable, mymetatable) <span class="comment">-- 设置元表</span></span><br><span class="line"><span class="built_in">getmetatable</span>(mytable) <span class="comment">-- 返回元表</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-2-index元方法">10.2 __index元方法</h3><p><code>__index</code>元方法用来对表访问。</p><p>Lua查找一个表元素时的规则：</p><p>1 在表中查找，如果找到，返回该元素，找不到继续</p><p>2 判断该表是否有元表，如果没有元表，返回nil，有元表则继续</p><p>3 判断该表有没有<code>__index</code>方法，如果<code>__index</code>方法为nil，则返回nil，如果<code>__index</code>方法是一个表，则重复1、2、3步；如果<code>__index</code>方法是一个函数，则返回该函数的返回值</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>({key1 = <span class="string">"value1"</span>}, {</span><br><span class="line">	<span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable, key)</span></span></span><br><span class="line">    	<span class="keyword">if</span> key == <span class="string">"key2"</span> <span class="keyword">then</span></span><br><span class="line">        	<span class="keyword">return</span> <span class="string">"metatablevalue"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">           	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">})</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"key1 = %s, key2 = %s"</span>, mytable.key1, mytable.key2))</span><br><span class="line"><span class="comment">-- 输出：key1 = value1, key2 = metatablevalue</span></span><br><span class="line"><span class="comment">-- 等价于</span></span><br><span class="line">mytable = <span class="built_in">setmetatable</span>({key1 = <span class="string">"value1"</span>}, {<span class="built_in">__index</span> = {key2 = <span class="string">"metatablevalue"</span>}})</span><br><span class="line"><span class="built_in">print</span>(mytable.key1, mytable.key2)</span><br><span class="line"><span class="comment">-- 输出：value1    metatablevalue</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-3-newindex元方法">10.3 __newindex元方法</h3><p><code>__newindex</code>元方法用来对表更新。</p><p>当给表的一个缺少的索引赋值，解释器会查找<code>__newindex</code>元方法，如果存在，则调用这个函数而不进行赋值操作。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>({key1 = <span class="string">"value1"</span>}, {</span><br><span class="line">    <span class="built_in">__newindex</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable, key, value)</span></span></span><br><span class="line">        <span class="built_in">rawset</span>(mytable, key, <span class="string">"\""</span>..value..<span class="string">"\""</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">})</span><br><span class="line">mytable.key1 = <span class="string">"new value"</span></span><br><span class="line">mytable.key2 = <span class="number">4</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.foramt(<span class="string">"key1 = %s, key2 = %s"</span>, mytable.key1, mytable.key2))</span><br><span class="line"><span class="comment">-- 输出：key1 = new value, key2 = "4"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-4-call元方法">10.4 __call元方法</h3><p><code>__call</code>元方法可以让table当做一个函数来使用。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> mt = {}</span><br><span class="line">mt.<span class="built_in">__call</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable,...)</span></span></span><br><span class="line">    <span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">ipairs</span>{...} <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(v)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">t = {}</span><br><span class="line"><span class="built_in">setmetatable</span>(t, mt)</span><br><span class="line">t(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-5-tostring元方法">10.5 __tostring元方法</h3><p><code>__tostring</code>元方法用于修改表的输出行为。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">mytable = <span class="built_in">setmetatable</span>({<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>}, {</span><br><span class="line">	<span class="built_in">__tostring</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable)</span></span></span><br><span class="line">        sum = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(mytable) <span class="keyword">do</span></span><br><span class="line">            sum = sum + v</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    	<span class="keyword">return</span> <span class="string">"sum = "</span> ..sum</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">})</span><br><span class="line"><span class="built_in">print</span>(mytable)</span><br><span class="line"><span class="comment">-- 输出：sum = 60</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-6-为表添加操作符">10.6 为表添加操作符</h3><table><thead><tr><th>模式</th><th>等价于运算符</th><th>模式</th><th>等价于运算符</th></tr></thead><tbody><tr><td>__add</td><td>+</td><td>__sub</td><td>-</td></tr><tr><td>__mul</td><td>*</td><td>__div</td><td>/</td></tr><tr><td>__mod</td><td>%</td><td>__unm</td><td>-</td></tr><tr><td>__concat</td><td>…</td><td>__eq</td><td>==</td></tr><tr><td>__lt</td><td>&lt;</td><td>__le</td><td>&lt;=</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">table_maxn</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">local</span> mn = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(t) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> mn &lt; k <span class="keyword">then</span></span><br><span class="line">            mn = k</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> mn</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 两表相加</span></span><br><span class="line">mytable = <span class="built_in">setmetatable</span>({<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>}, {</span><br><span class="line">    <span class="built_in">__add</span> = <span class="function"><span class="keyword">function</span><span class="params">(mytable, newtable)</span></span></span><br><span class="line">        <span class="keyword">for</span> i = <span class="number">1</span>, table_maxn(newtable) <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">table</span>.<span class="built_in">insert</span>(mytable, table_maxn(mytable)+<span class="number">1</span>, newtable[i])</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> mytable</span><br><span class="line">   	<span class="keyword">end</span></span><br><span class="line">})</span><br><span class="line">secondtable = {<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>}</span><br><span class="line">mytable = mytable + secondtable</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(mytable) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k, v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1   1</span></span><br><span class="line"><span class="comment">2   2</span></span><br><span class="line"><span class="comment">3   3</span></span><br><span class="line"><span class="comment">4   4</span></span><br><span class="line"><span class="comment">5   5</span></span><br><span class="line"><span class="comment">6   6</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="11-模块与包">11. 模块与包</h2><h3 id="11-1-模块定义">11.1 模块定义</h3><p>模块类似于一个封装库，是由变量、函数等已知元素组成的table，因此创建模块就是创建一个table，然后把需要导出的常量、函数放入其中，最后返回这个table即可。如下创建自定义模块module。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 文件名 module.lua</span></span><br><span class="line"><span class="comment">-- 定义一个名为module的模块</span></span><br><span class="line"><span class="built_in">module</span> = {}</span><br><span class="line"><span class="comment">-- 定义一个常量</span></span><br><span class="line"><span class="built_in">module</span>.constant = <span class="string">"this is constant"</span></span><br><span class="line"><span class="comment">-- 定义一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func1</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">"This is a public function\n"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">"This is a private function"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func3</span><span class="params">()</span></span></span><br><span class="line">    func2()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">module</span></span><br></pre></td></tr></tbody></table></figure><h3 id="11-2-require函数">11.2 require函数</h3><p><code>require("模块名")</code>用来加载模块，执行require后会返回一个由模块常量或函数组成的table，并且还会定义一个包含该table的全局变量。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">"module"</span>)</span><br><span class="line"><span class="comment">-- 别名变量 m</span></span><br><span class="line"><span class="keyword">local</span> m = <span class="built_in">require</span>(<span class="string">"module"</span>)</span><br><span class="line"><span class="built_in">print</span>(m.constant)</span><br><span class="line">m.func3()</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">this is constant</span></span><br><span class="line"><span class="comment">This is a private function</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><p>require函数会尝试从Lua文件或C程序中加载模块，require用于搜索Lua文件的路径存放在全局变量package_path中，当Lua启动后，会以环境变量LUA_PATH的值来初始化这个环境变量，如果找不到该环境变量，则使用一个编译时定义的默认路径来初始化。</p><p>可以自定义设置路况，在当前用户跟目录下打开.profile文件（没有则创建，打开.bashrc文件也可以），例如把"~/lua/"路径加入LUA_PATH环境变量里。</p><figure class="highlight sh"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#LUA_PATH</span></span><br><span class="line"><span class="built_in">export</span> LAU_PATH=<span class="string">"~/lua/?.lua;;"</span></span><br></pre></td></tr></tbody></table></figure><p>文件路径以";“号分割，最后两个”;;"表示新加的路径后面加上原来的默认路径。</p><p>接着执行指令<code>source ~/.profile</code>更新变量参数使之生效。</p><p>如果找到目标文件，则会调用<code>package.loadfile</code>来加载模块，否则就会找C程序库。</p><p>搜索的文件路径是从全局变量 package.cpath 获取，而这个变量则是通过环境变量 LUA_CPATH 来初始。</p><p>搜索的策略跟上面的一样，只不过现在换成搜索的是 so 或 dll 类型的文件。如果找得到，那么 require 就会通过 package.loadlib 来加载它。</p><h3 id="11-3-module函数">11.3 module函数</h3><p><code>module()</code>函数调用时会创建表并将其赋予给全局变量和loaded table，最后还会将这个表设置为主程序块的环境。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 在模块文件在使用module函数</span></span><br><span class="line"><span class="built_in">module</span> <span class="string">"module_name"</span></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">等同语法</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line"><span class="comment">-- 定义模块名</span></span><br><span class="line"><span class="keyword">local</span> moduleName = <span class="string">"module_name"</span></span><br><span class="line"><span class="comment">-- 定义用于返回的模块表</span></span><br><span class="line"><span class="keyword">local</span> M = {}</span><br><span class="line"><span class="comment">-- 将模块表加入到全局变量</span></span><br><span class="line"><span class="built_in">_G</span>[moduleName] = M</span><br><span class="line"><span class="comment">-- 将模块表加入到package.loaded中防止多次加载</span></span><br><span class="line"><span class="built_in">package</span>.<span class="built_in">loaded</span>[moduleName] = M</span><br><span class="line"><span class="comment">-- 将模块表设置为函数的环境表，使得模块中的所有操作都是在模块表中，这样定义函数就直接定义在模块表中</span></span><br><span class="line"><span class="built_in">setfenv</span>(<span class="number">1</span>, M)</span><br></pre></td></tr></tbody></table></figure><h3 id="11-4-调用C语言包">11.4 调用C语言包</h3><p>Lua和C语言很容易结合，可以使用C语言为Lua写包，C语言包使用前必须先加载并连接，大多数系统是通过动态连接库机制。</p><p>Lua在一个加loadlib的函数内提供了所有的动态连接功能。这个函数的两个参数：库的绝对路径和初始化函数，如：</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">"/usr/local/lua/lib/libluasocket.so"</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">loadlib</span>(<span class="built_in">path</span>, <span class="string">"luaopen_socket"</span>)</span><br></pre></td></tr></tbody></table></figure><p>loadlib函数加载指定的库并连接到Lua，然而并没有调用初始化函数，而是返回初始化函数作为Lua的一个函数。</p><p>如果加载动态库或者查找初始化函数出错，loadlib将返回nil和错误信息。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">"C:\\windows\\luasocket.dll"</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">loadlib</span>(<span class="built_in">path</span>, <span class="string">"luaopen_socket"</span>)</span><br><span class="line"><span class="comment">-- 真正打开库</span></span><br><span class="line">f()</span><br></pre></td></tr></tbody></table></figure><p>一般情况下我们期望二进制的发布库包含一个与前面代码段相似的 stub 文件，安装二进制库的时候可以随便放在某个目录，只需要修改 stub 文件对应二进制库的实际路径即可。</p><p>将 stub 文件所在的目录加入到 LUA_PATH，这样设定后就可以使用 require 函数加载 C 库了。</p><h2 id="12-协程">12. 协程</h2><h3 id="12-1-定义">12.1 定义</h3><p>协程与线程比较类似，拥有独立的堆栈、独立的局部变量、独立的指令，同时又与其他协同程序共享全局变量和其他大部分东西。</p><p>一个具有多线程的程序可以同时运行几个线程，而协程却需要彼此写作运行，在任一指定时刻只有一个协程在运行，并且这个正在运行的协同程序只有在明确的被要求挂起时才会被挂起。</p><p>协程有点类似同步的多线程，在等待同一个线程锁的几个线程有点类似协程。</p><h3 id="12-2-用法">12.2 用法</h3><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>coroutine.create()</td><td>创建coroutine，返回coroutine，参数是一个函数，当和resume配合使用时唤醒函数调用</td></tr><tr><td>coroutine.resume()</td><td>重启coroutine，和create配合使用</td></tr><tr><td>coroutine.yield()</td><td>挂起coroutine，将coroutine设置为挂起状态，和resume配合使用能够有很多效果</td></tr><tr><td>coroutine.status()</td><td>查看coroutine的状态，有dead、suspened、running三种状态</td></tr><tr><td>coroutine.wrap()</td><td>创建coroutine，返回一个函数，一旦调用这个函数，就进入croutine，和create功能重复</td></tr><tr><td>coroutine.running()</td><td>返回正在运行的coroutine，一个coroutine就是一个新村，返回一个coroutine的线程号</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">(a)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"foo函数输出"</span>, a)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(<span class="number">2</span> * a)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">co = <span class="built_in">coroutine</span>.<span class="built_in">create</span>(<span class="function"><span class="keyword">function</span> <span class="params">(a, b)</span></span> </span><br><span class="line">    	<span class="built_in">print</span>(<span class="string">"第一次协同程序执行输出"</span>, a, b)</span><br><span class="line">        <span class="keyword">local</span> r = foo(a + <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    	<span class="built_in">print</span>(<span class="string">"第二次协同程序执行输出"</span>, r)</span><br><span class="line">        <span class="keyword">local</span> r, s = <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(a + b, a - b)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"第三次协同程序执行输出"</span>, r, s)</span><br><span class="line">        <span class="keyword">return</span> b, <span class="string">"结束协同程序"</span></span><br><span class="line">   	<span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"main"</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"--分割线--"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"main"</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="string">"r"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"--分割线--"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"main"</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="string">"x"</span>, <span class="string">"y"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"--分割线--"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"main"</span>, <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="string">"x"</span>, <span class="string">"y"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"--分割线--"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">第一次协同程序执行输出 1 10</span></span><br><span class="line"><span class="comment">foo 函数输出 2</span></span><br><span class="line"><span class="comment">main true 4</span></span><br><span class="line"><span class="comment">--分割线--</span></span><br><span class="line"><span class="comment">第二次协同程序执行输出 r</span></span><br><span class="line"><span class="comment">main true 11 -9</span></span><br><span class="line"><span class="comment">--分割线--</span></span><br><span class="line"><span class="comment">第三次协同程序执行输出 x y</span></span><br><span class="line"><span class="comment">main true 10 结束协同程序</span></span><br><span class="line"><span class="comment">--分割线--</span></span><br><span class="line"><span class="comment">main false 10 cannot resume dead coroutine</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="12-3-生产者-消费者问题">12.3 生产者-消费者问题</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> newProductor</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">productor</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line">        send(i)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">consumer</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> i = receive()</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receive</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">status</span>, value = <span class="built_in">coroutine</span>.<span class="built_in">resume</span>(newProductor)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">(x)</span></span></span><br><span class="line">    <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(x)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">newProductor = coutine.<span class="built_in">create</span>(productor)</span><br><span class="line">cosumer()</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">7</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="13-文件IO">13. 文件IO</h2><p>Lua文件IO库用于读取和处理文件，分为<strong>简单模式</strong>和<strong>完全模式</strong>：</p><ul><li>简单模式：拥有一个当前输入文件和一个当前输出文件，并且提供针对这些文件相关的操作，适合做一些简单的文件操作</li><li>完全模式：使用外部的文件句柄来实现，以一种面向对象的形式，将所有的文件操作定义为文件句柄的方法，适合做一些高级的文件操作，如同时读取多个文件</li></ul><h3 id="13-1-简单模式">13.1 简单模式</h3><table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td>io.input([file])</td><td>设置默认的输入文件，file为文件名，返回文件句柄</td></tr><tr><td>io.output([file])</td><td>设置默认的输出文件，file为文件名</td></tr><tr><td>io.close([file])</td><td>关闭文件，不带参数的默认文件</td></tr><tr><td>io.read(formats)</td><td>读取默认文件，formats取值为<code>a*</code>-全读、<code>*n</code>-按数字读入、<code>*l</code>-按行读入，<code>n</code>-读取n个字符</td></tr><tr><td>io.lines([fn])</td><td>fn文件名，如无文件，取默认文件，返回一个迭代器</td></tr><tr><td>io.write(value)</td><td>向默认文件写入内容</td></tr><tr><td>io.flush()</td><td>把文件缓存里的操作立即作用到默认输出文件</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 以只读方式打开文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"test.lua"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="comment">-- 设置默认输入文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">input</span>(file)</span><br><span class="line"><span class="comment">-- 输出文件第一行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"read file: [%s]"</span>, <span class="built_in">io</span>.<span class="built_in">read</span>()))</span><br><span class="line"><span class="comment">-- 关闭文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file)</span><br><span class="line"><span class="comment">-- 以附加的方式打开只写文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"test.lua"</span>, <span class="string">"a"</span>)</span><br><span class="line"><span class="comment">-- 设置默认输出文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">output</span>(file)</span><br><span class="line"><span class="comment">-- 在文件最后一行写入</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">"File content in test.lua"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"file write success"</span>)</span><br><span class="line"><span class="comment">-- 关闭文件</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file)</span><br></pre></td></tr></tbody></table></figure><h3 id="13-2-完全模式">13.2 完全模式</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 以只读方式打开文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"test.lua"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="comment">-- 输出文件第一行</span></span><br><span class="line"><span class="built_in">print</span>(file:<span class="built_in">read</span>())</span><br><span class="line"><span class="comment">-- 关闭打开的文件</span></span><br><span class="line">file::<span class="built_in">close</span>()</span><br><span class="line"><span class="comment">-- 以附加的方式打开只写文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"test.lua"</span>, <span class="string">"a"</span>)</span><br><span class="line"><span class="comment">-- 在文件最后一行写入</span></span><br><span class="line">file::<span class="built_in">write</span>(<span class="string">"--test"</span>)</span><br><span class="line"><span class="comment">-- 关闭打开的文件</span></span><br><span class="line">file::<span class="built_in">close</span>()</span><br><span class="line"><span class="comment">-- 以只读方式打开文件</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">"test.lua"</span>, <span class="string">"r"</span>)</span><br><span class="line"><span class="comment">-- 定位到文件倒数第25个位置</span></span><br><span class="line">file::seek(<span class="string">"end"</span>, <span class="number">-25</span>)</span><br><span class="line"><span class="comment">-- 从当前（倒数第25个位置）读取整个文件</span></span><br><span class="line"><span class="built_in">print</span>(file::<span class="built_in">read</span>(<span class="string">"*a"</span>))</span><br><span class="line"><span class="comment">-- 关闭打开的文件</span></span><br><span class="line">file::<span class="built_in">close</span>()</span><br></pre></td></tr></tbody></table></figure><h2 id="14-错误处理">14. 错误处理</h2><p>错误类型分为<strong>语法错误</strong>和<strong>运行错误</strong>。</p><p>语法错误通常是对程序的组件使用不当引起，如：</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> a = <span class="number">1</span>, <span class="number">10</span></span><br><span class="line">	<span class="built_in">print</span>(a)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 输出：lua: main.lua:2: 'do' expected near 'print'</span></span><br></pre></td></tr></tbody></table></figure><p>运行错误时程序可以正常运行，但是会输出报错信息，如：</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">add(<span class="number">10</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">lua: main.lua:2: attempt to perform arithmetic on local 'b' (a nil value)</span></span><br><span class="line"><span class="comment">stack traceback:</span></span><br><span class="line"><span class="comment">    main.lua:2: in function 'add'</span></span><br><span class="line"><span class="comment">    main.lua:4: in main chunk</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="14-1-assert">14.1 assert</h3><p><code>assert(express, message)</code> 断言函数会判断给定express表达式是否成立，成立的话不做任何事情，不成立则以message作为错误信息抛出。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">type</span>(a) == <span class="string">"number"</span>, <span class="string">"a not a number"</span>)</span><br><span class="line">    <span class="built_in">assert</span>(<span class="built_in">type</span>(b) == <span class="string">"number"</span>, <span class="string">"b not a number"</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">add(<span class="number">10</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">lua: main.lua:3: b not a number</span></span><br><span class="line"><span class="comment">stack traceback:</span></span><br><span class="line"><span class="comment">    [C]: in function 'assert'</span></span><br><span class="line"><span class="comment">    main.lua:3: in function 'add'</span></span><br><span class="line"><span class="comment">    main.lua:6: in main chunk</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="14-2-error">14.2 error</h3><p><code>error(message [,level])</code> 函数终止正在执行的函数，并返回message的内容作为错误信息，level参数指示获得错误的位置，level=1指出调用error位置，level=2指出调用error函数的函数吗，level=0不添加错误位置信息。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">type</span>(a) ~= <span class="string">"number"</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">error</span>(<span class="string">"a not a number"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">type</span>(b) ~= <span class="string">"number"</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">error</span>(<span class="string">"b not a number"</span>, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">add(<span class="number">10</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">lua: main.lua:10: b not a number</span></span><br><span class="line"><span class="comment">stack traceback:</span></span><br><span class="line"><span class="comment">    [C]: in function 'error'</span></span><br><span class="line"><span class="comment">    main.lua:6: in function 'add'</span></span><br><span class="line"><span class="comment">    main.lua:10: in main chunk</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="14-3-pcall">14.3 pcall</h3><p>可以使用<code>pcall</code>函数包装需要执行的代码，<code>pcall</code>函数接收一个函数和要传递给后者的参数，并执行该函数，无错误返回true，有错误返回false和错误信息。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">a, errorinfo = <span class="built_in">pcall</span>(<span class="function"><span class="keyword">function</span><span class="params">(i)</span></span> <span class="built_in">print</span>(i) <span class="keyword">end</span>, <span class="number">27</span>)</span><br><span class="line"><span class="built_in">print</span>(a, errorinfo)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">27</span></span><br><span class="line"><span class="comment">true nil</span></span><br><span class="line"><span class="comment">--]]</span></span><br><span class="line">b, errorinfo = <span class="built_in">pcall</span>(<span class="function"><span class="keyword">function</span><span class="params">(i)</span></span> <span class="built_in">print</span>(i) <span class="built_in">error</span>(<span class="string">'error..'</span>) <span class="keyword">end</span>, <span class="number">27</span>)</span><br><span class="line"><span class="built_in">print</span>(b, errorinfo)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">27</span></span><br><span class="line"><span class="comment">false main.lua1: error..</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="14-4-xpcall">14.4 xpcall</h3><p><code>xpcall</code>函数相比<code>pcall</code>函数会返回更多的错误调试信息，并执行该函数，无错误返回true，有错误返回false和错误信息。</p><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myfunction</span> <span class="params">()</span></span></span><br><span class="line">   n = n / <span class="literal">nil</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myerrorhandler</span><span class="params">(err)</span></span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"ERROR:"</span>, err)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">status</span> = <span class="built_in">xpcall</span>(myfunction, myerrorhandler)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">status</span>)</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">ERROR:  main.lua:2: attempt to perform arithmetic on global 'n' (a nil value)</span></span><br><span class="line"><span class="comment">false</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="15-垃圾回收">15. 垃圾回收</h2><h3 id="15-1-机制">15.1 机制</h3><p>Lua运行了一个垃圾收集器收集所有死对象来完成自动内存管理的工作。</p><p>Lua实现了一个增量标记-扫描收集器，使用垃圾收集器间歇率和垃圾收集器步进倍率来控制垃圾收集循环。</p><p>垃圾收集器间歇率控制着收集器需要在开启新的循环前要等待多久。</p><p>垃圾收集器步进倍率控制收集器运作速度相对与内存分配速度的倍率，默认值是200%，即运作速度2倍于内存分配速率。</p><h3 id="15-2-垃圾回收器函数">15.2 垃圾回收器函数</h3><p>Lua提供一下函数<code>collectgarbage([opt [,arg]])</code>来控制自动内存管理。</p><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>collectgarbage(“collect”)</td><td>做一次完整的垃圾收集循环</td></tr><tr><td>collectgarbage(“count”)</td><td>以K字节数为单位返回Lua使用的总内存数</td></tr><tr><td>collectgarbage(“restart”)</td><td>重启垃圾收集器的自动运行</td></tr><tr><td>collectgarbage(“setpause”)</td><td>将arg设为收集器的间歇率，返回间歇率的前一个值</td></tr><tr><td>collectgarbage(“setstepmul”)</td><td>返回步进倍率的前一个值</td></tr><tr><td>collectgarbage(“step”)</td><td>单步运行垃圾收集器，步长由arg控制</td></tr><tr><td>collectgarbage(“stop”)</td><td>停止垃圾收集器的运行</td></tr></tbody></table><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line">mytable = {<span class="string">"apple"</span>, <span class="string">"orange"</span>, <span class="string">"banana"</span>}</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">"count"</span>))</span><br><span class="line">mytable = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">"count"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">"collect"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">collectgarbage</span>(<span class="string">"count"</span>))</span><br><span class="line"><span class="comment">--[[ 输出：</span></span><br><span class="line"><span class="comment">27.6396484375</span></span><br><span class="line"><span class="comment">27.6767578125</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">26.623046875</span></span><br><span class="line"><span class="comment">--]]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="16-面向对象">16. 面向对象</h2><h3 id="16-1-面向对象特征">16.1 面向对象特征</h3><ul><li><p>封装：能够把一个实体的信息、功能、响应都装入一个单独的对象中的特征。</p></li><li><p>继承：基础的方法允许在不改动原程序的基础上对其进行扩充，使得原功能得以保存，新功能也得以扩展，有利于减少重复代码，提高开发效率。</p></li><li><p>多态：同一操作作用于不同的对象，产生不同的执行结果，可以通过指向基类的指针，来调用实现派生类的方法。</p></li><li><p>抽象：简化复杂问题的方法，可以为具体问题找到最恰当的类定义，并且可以在最恰当的继承级别解释问题。</p></li></ul><h3 id="16-2-类封装">16.2 类封装</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 元类</span></span><br><span class="line">Shape = { area = <span class="number">0</span> }</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基础类方法 new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:new</span> <span class="params">(o, size)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> {}</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, <span class="built_in">self</span>)</span><br><span class="line">    <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">    size = size <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">self</span>.area = size * size</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基础类方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:pirntArea</span> <span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The area = "</span>, <span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建对象</span></span><br><span class="line">myshape = Shape:new(<span class="literal">nil</span>, <span class="number">10</span>)</span><br><span class="line">myshape:printArea()</span><br><span class="line"><span class="comment">-- 输出：The area = 100</span></span><br></pre></td></tr></tbody></table></figure><h3 id="16-3-继承与多态">16.3 继承与多态</h3><figure class="highlight lua"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 元类</span></span><br><span class="line">Shape = { area = <span class="number">0</span> }</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基础类方法 new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:new</span> <span class="params">(o, size)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> {}</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, <span class="built_in">self</span>)</span><br><span class="line">    <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">    size = size <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line">    <span class="built_in">self</span>.area = size * size</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基础类方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Shape:pirntArea</span> <span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The area = "</span>, <span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建对象</span></span><br><span class="line">myshape = Shape:new(<span class="literal">nil</span>, <span class="number">10</span>)</span><br><span class="line">myshape:printArea()</span><br><span class="line"><span class="comment">-- 输出：The area = 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 继承1</span></span><br><span class="line">Square = Shape:new()</span><br><span class="line"><span class="comment">-- 派生类方法 new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:new</span> <span class="params">(o, size)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> Shape:new(o, size)</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, <span class="built_in">self</span>)</span><br><span class="line">    <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 派生类方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square:printArea</span> <span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The Square area = "</span>, <span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建对象</span></span><br><span class="line">mysquare = Square:new(<span class="literal">nil</span>, <span class="number">10</span>)</span><br><span class="line">mysquare:printArea()</span><br><span class="line"><span class="comment">-- 输出：The Square area = 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 继承2</span></span><br><span class="line">Rectangle = Shape:new()</span><br><span class="line"><span class="comment">-- 派生类方法 new</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:new</span> <span class="params">(o, length, breadth)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> Shape:new(o, size)</span><br><span class="line">    <span class="built_in">setmetatable</span>(o, <span class="built_in">self</span>)</span><br><span class="line">    <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">    <span class="built_in">self</span>.area = length * breadth</span><br><span class="line">    <span class="keyword">return</span> o</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 派生类方法 printArea</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Rectangle:printArea</span> <span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The Rectangle area = "</span>, <span class="built_in">self</span>.area)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建对象</span></span><br><span class="line">myrectangle = Rectangle:new(<span class="literal">nil</span>, <span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">myrectangle:printArea()</span><br><span class="line"><span class="comment">-- 输出：The Rectangle area = 200</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="参考文章-4">参考文章</h2><p>本文是笔者通过下列网站教程学习Lua的记录，有部分修改和补充，转载请注明出处，并附带下面链接。</p><p>1.<a target="_blank" rel="noopener" href="https://www.runoob.com/lua/lua-tutorial.html">【菜鸟教程Lua教程】</a></p><p>2.<a target="_blank" rel="noopener" href="https://haicoder.net/lua/lua-tutorial.html">【嗨客网Lua教程】</a></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://xiongbinzou.github.io">小邹同学</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://xiongbinzou.github.io/posts/5067.html">https://xiongbinzou.github.io/posts/5067.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://xiongbinzou.github.io" target="_blank">小邹同学</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><a class="post-meta__tags" href="/tags/Unity%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/">Unity开发基础</a><a class="post-meta__tags" href="/tags/Lua%E5%9F%BA%E7%A1%80/">Lua基础</a></div><div class="post_share"><div class="social-share" data-image="/pics/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/pics/reward/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/pics/reward/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/pics/reward/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/pics/reward/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/posts/19904.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python虚拟环境的使用</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/16133.html" title="C#语言进阶学习笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-16</div><div class="title">C#语言进阶学习笔记</div></div></a></div><div><a href="/posts/6569.html" title="C#语言基础学习笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-10</div><div class="title">C#语言基础学习笔记</div></div></a></div><div><a href="/posts/38460.html" title="Docker入门教程学习笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-27</div><div class="title">Docker入门教程学习笔记</div></div></a></div><div><a href="/posts/47611.html" title="Docker进阶教程学习笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-28</div><div class="title">Docker进阶教程学习笔记</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">0. 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">0.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-2-Windows%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%AE%89%E8%A3%85Lua"><span class="toc-text">0.2 Windows下载与安装Lua</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-3-CentOS%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%AE%89%E8%A3%85Lua"><span class="toc-text">0.3 CentOS下载与安装Lua</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0-4-%E6%8E%A8%E8%8D%90IDE"><span class="toc-text">0.4 推荐IDE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">1. 基本数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-table"><span class="toc-text">1.1 table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-string"><span class="toc-text">1.2 string</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-number"><span class="toc-text">1.3 number</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-boolean"><span class="toc-text">1.4 boolean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-nil"><span class="toc-text">1.5 nil</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-function"><span class="toc-text">1.6 function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-thread"><span class="toc-text">1.7 thread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-userdata"><span class="toc-text">1.8 userdata</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B3%A8%E9%87%8A"><span class="toc-text">2. 注释</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%8D%95%E8%A1%8C%E6%B3%A8%E9%87%8A"><span class="toc-text">2.1 单行注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%A4%9A%E8%A1%8C%E6%B3%A8%E9%87%8A"><span class="toc-text">2.2 多行注释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%98%E9%87%8F"><span class="toc-text">3. 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC"><span class="toc-text">3.1 变量赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E5%92%8C%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="toc-text">3.2 全局变量和局部变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">3.3 类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%8E%B7%E5%8F%96%E8%BE%93%E5%85%A5"><span class="toc-text">3.4 获取输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-text">3.5 格式化输出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6"><span class="toc-text">4. 循环控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-while"><span class="toc-text">4.1 while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-repeat-%E2%80%A6-until"><span class="toc-text">4.2 repeat … until</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-for"><span class="toc-text">4.3 for</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-break"><span class="toc-text">4.4 break</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-return"><span class="toc-text">4.5 return</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-goto"><span class="toc-text">4.6 goto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-pairs%E5%92%8Cipairs"><span class="toc-text">4.7 pairs和ipairs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%86%E6%94%AF%E6%8E%A7%E5%88%B6"><span class="toc-text">5. 分支控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-if"><span class="toc-text">5.1 if</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-else"><span class="toc-text">5.2 else</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-elseif"><span class="toc-text">5.3 elseif</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%9D%A1%E4%BB%B6%E5%B5%8C%E5%A5%97"><span class="toc-text">5.4 条件嵌套</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%87%BD%E6%95%B0"><span class="toc-text">6. 函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-function"><span class="toc-text">6.1 function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">6.2 多返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="toc-text">6.3 可变参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="toc-text">6.4 匿名函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E9%97%AD%E5%8C%85"><span class="toc-text">6.5 闭包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">7. 运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">7.1 算术运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">7.2 关系运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">7.3 逻辑运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%85%B6%E4%BB%96%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">7.4 其他运算符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">8. 字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-text">8.1 字符串函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%A4%A7%E5%B0%8F%E5%86%99%E8%BD%AC%E6%8D%A2"><span class="toc-text">8.1 大小写转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96"><span class="toc-text">8.2 字符串截取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9B%BF%E6%8D%A2"><span class="toc-text">8.3 字符串替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8A%A0%E8%BD%BD"><span class="toc-text">8.4 序列化与加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE"><span class="toc-text">8.5 字符串查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%8D%E8%BD%AC"><span class="toc-text">8.6 字符串反转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">8.7 格式化字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-%E6%95%B0%E5%AD%97%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-text">8.8 数字与字符的转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-9-%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6"><span class="toc-text">8.9 字符串长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-10-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%B7%E8%B4%9D"><span class="toc-text">8.10 字符串拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-11-%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5"><span class="toc-text">8.11 字符串连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-12-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D"><span class="toc-text">8.12 字符串匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-13-%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6"><span class="toc-text">8.13 转义字符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Table"><span class="toc-text">9. Table</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E5%AE%9A%E4%B9%89"><span class="toc-text">9.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E9%81%8D%E5%8E%86"><span class="toc-text">9.2 遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E8%BF%9E%E6%8E%A5"><span class="toc-text">9.3 连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E6%8F%92%E5%85%A5"><span class="toc-text">9.4 插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-%E6%9C%80%E5%A4%A7%E5%80%BC"><span class="toc-text">9.5 最大值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-%E5%88%A0%E9%99%A4"><span class="toc-text">9.6 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-%E6%8E%92%E5%BA%8F"><span class="toc-text">9.7 排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%85%83%E7%B4%A0metatable"><span class="toc-text">10. 元素metatable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E5%AE%9A%E4%B9%89"><span class="toc-text">10.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-index%E5%85%83%E6%96%B9%E6%B3%95"><span class="toc-text">10.2 __index元方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-newindex%E5%85%83%E6%96%B9%E6%B3%95"><span class="toc-text">10.3 __newindex元方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-call%E5%85%83%E6%96%B9%E6%B3%95"><span class="toc-text">10.4 __call元方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-tostring%E5%85%83%E6%96%B9%E6%B3%95"><span class="toc-text">10.5 __tostring元方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-%E4%B8%BA%E8%A1%A8%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">10.6 为表添加操作符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85"><span class="toc-text">11. 模块与包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89"><span class="toc-text">11.1 模块定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-require%E5%87%BD%E6%95%B0"><span class="toc-text">11.2 require函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-module%E5%87%BD%E6%95%B0"><span class="toc-text">11.3 module函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-%E8%B0%83%E7%94%A8C%E8%AF%AD%E8%A8%80%E5%8C%85"><span class="toc-text">11.4 调用C语言包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%8D%8F%E7%A8%8B"><span class="toc-text">12. 协程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-%E5%AE%9A%E4%B9%89"><span class="toc-text">12.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E7%94%A8%E6%B3%95"><span class="toc-text">12.2 用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98"><span class="toc-text">12.3 生产者-消费者问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E6%96%87%E4%BB%B6IO"><span class="toc-text">13. 文件IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">13.1 简单模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-%E5%AE%8C%E5%85%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">13.2 完全模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">14. 错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-assert"><span class="toc-text">14.1 assert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-error"><span class="toc-text">14.2 error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-pcall"><span class="toc-text">14.3 pcall</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-4-xpcall"><span class="toc-text">14.4 xpcall</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-text">15. 垃圾回收</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-%E6%9C%BA%E5%88%B6"><span class="toc-text">15.1 机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%87%BD%E6%95%B0"><span class="toc-text">15.2 垃圾回收器函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-text">16. 面向对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#16-1-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%89%B9%E5%BE%81"><span class="toc-text">16.1 面向对象特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-2-%E7%B1%BB%E5%B0%81%E8%A3%85"><span class="toc-text">16.2 类封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-3-%E7%BB%A7%E6%89%BF%E4%B8%8E%E5%A4%9A%E6%80%81"><span class="toc-text">16.3 继承与多态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0-4"><span class="toc-text">参考文章</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image:url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By 小邹同学</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">你好，欢迎来到<a href="https://xiongbinzou.github.io">小邹同学的Secret Base</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.2},options:{renderActions:{findScript:[10,t=>{for(const e of document.querySelectorAll('script[type^="math/tex"]')){const a=!!e.type.match(/; *mode=display/),n=new t.options.MathItem(e.textContent,t.inputJax[0],a),s=document.createTextNode("");e.parentNode.replaceChild(s,e),n.start={node:s,delim:"",n:0},n.end={node:s,delim:"",n:0},t.math.push(n)}},""],insertScript:[200,()=>{document.querySelectorAll("mjx-container:not([display])").forEach((t=>{const e=t.parentNode;"li"===e.nodeName.toLowerCase()?e.parentNode.classList.add("has-jax"):e.classList.add("has-jax")}))},"",!1]}}};const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js",t.id="MathJax-script",t.async=!0,document.head.appendChild(t)}</script><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(e.length){window.runMermaid=()=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach(((e,n)=>{const d=e.firstElementChild,r="mermaid-"+n,i="%%{init:{ 'theme':'"+t+"'}}%%\n"+d.textContent;mermaid.mermaidAPI.render(r,i,(e=>{d.insertAdjacentHTML("afterend",e)}))}))};const t=()=>{window.loadMermaid?runMermaid():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(runMermaid)};window.pjax?t():document.addEventListener("DOMContentLoaded",t)}})()</script><script>function loadValine(){function n(){new Valine(Object.assign({el:"#vcomment",appId:"WU7g4I4cNK7LYpz3RJVoz1YV-gzGzoHsz",appKey:"4MHXbgYuTwfEzqQofOeNVquO",avatar:"monsterid",serverURLs:"",emojiMaps:"",path:window.location.pathname,visitor:!1},null))}"function"==typeof Valine?n():getScript("https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js").then(n)}{function loadOtherComment(){loadValine()}setTimeout(loadValine,0)}</script></div><div class="aplayer no-destroy" data-id="5183531430" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,log:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:150,height:190},mobile:{show:!1},react:{opacity:1}})</script></body></html>